<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Health Data Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-2xl font-bold text-center mb-6">Student Health Data Entry</h1>
    <form id="healthForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4 bg-white p-6 rounded-lg shadow">
      <!-- Fields will be injected here -->
    </form>

    <div class="flex flex-col sm:flex-row gap-2 mt-6 justify-center">
      <button type="button" onclick="searchData()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Search</button>
      <button type="button" onclick="submitData()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Save</button>
    </div>

    <p id="message" class="text-center text-sm font-semibold mt-4 text-green-600"></p>
  </div>

  <script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGkcaoSo8RhvFwyfml8ePyyXz8sBdhJu7RXXXZ5TlXYNIKK2Asyvk56Xlg4kdJl6OR/exec";

    const fields = [
      "Name", "Age", "Blood group", "FBS level (glucometer)", "FBS level (glucose oxidase kit)",
      "Weight", "Height", "Waist circumference", "Hip circumference", "Mid upper arm circumference",
      "Mid upper arm length", "Mid upper arm skin fold thikness", "Body fat", "Visceral fat",
      "Resting Metabolism", "BMI", "Body age", "Subcutaneous fat whole body", "Subcutaneous fat trunk",
      "Subcutaneous fat Arm", "Subcutaneous fat leg", "Skeletal muscle fat whole body",
      "Skeletal muscle trunk", "Skeletal muscle arm", "Skeletal muscle leg"
    ];

    const form = document.getElementById("healthForm");
    const message = document.getElementById("message");

    // Build input fields and store references
    const fieldRefs = {};
    fields.forEach(field => {
      const wrapper = document.createElement("div");
      const label = document.createElement("label");
      label.textContent = field;
      label.className = "block text-sm font-medium text-gray-700";

      const input = document.createElement("input");
      input.placeholder = field;
      input.name = field;
      input.className = "border p-2 rounded w-full mt-1";
      fieldRefs[field] = input;

      wrapper.appendChild(label);
      wrapper.appendChild(input);
      form.appendChild(wrapper);
    });

    function getFormData() {
      const data = {};
      fields.forEach(field => {
        data[field] = fieldRefs[field].value.trim();
      });
      return data;
    }

    function fillForm(data) {
      fields.forEach(field => {
        if (fieldRefs[field]) {
          fieldRefs[field].value = data[field] || "";
        }
      });
    }

    function submitData() {
      const data = getFormData();
      if (!data["Name"]) {
        message.textContent = "Name is required.";
        return;
      }
      data["Timestamp"] = new Date().toISOString();

      fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(response => {
        message.textContent = response === "Success" ? "Data saved successfully." : "Failed to save data.";
      })
      .catch(err => {
        message.textContent = "Error: " + err.message;
      });
    }

    function searchData() {
      const name = fieldRefs["Name"].value.trim();
      if (!name) {
        message.textContent = "Name is required for search.";
        return;
      }

      fetch(`${GOOGLE_SCRIPT_URL}?name=${encodeURIComponent(name)}`)
        .then(res => res.json())
        .then(data => {
          if (Object.keys(data).length === 0) {
            message.textContent = "Record not found.";
          } else {
            fillForm(data);
            message.textContent = "Record loaded.";
          }
        })
        .catch(err => {
          message.textContent = "Error: " + err.message;
        });
    }
  </script>
</body>
</html>
